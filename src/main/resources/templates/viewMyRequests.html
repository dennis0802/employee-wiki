<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" media="all" th:href="@{/styles.css}">
        <link rel="icon" type="image/x-icon" th:href="@{/img/favicon.ico}">
        <title>View Time-Off Requests</title>
    </head>

    <body>
        <header>
            <div>
                <a href="/index">
                    <img th:src="@{/img/defaultLogo.png}" alt="Default HRIS logo" width="108px" height="60px"/>
                </a>
            </div>
            <div class="scrollmenu">
                <a href="/"><b>Home</b></a>
                <a href="/orgChart" th:if="${!#strings.isEmpty(username)}"><b>Organization Chart</b></a>
                <a href="/gal" th:if="${!#strings.isEmpty(username)}"><b>Global Address List</b></a>
                <a class="selected" href="/viewRequests" th:if="${!#strings.isEmpty(username)}"><b>My Time Off Requests</b></a>
                <a href="/viewMyPay" th:if="${!#strings.isEmpty(username)}"><b>My Pay</b></a>
                <a href="/calendar" th:if="${!#strings.isEmpty(username)}"><b>Calendar</b></a>
                <a href="/resources" th:if="${!#strings.isEmpty(username)}"><b>Resources</b></a>
                <a href="/hrMenu" th:if="${!#strings.isEmpty(username) and (#strings.equals(role, 'ADMIN') or #strings.equals(#strings.substring(role, 0, 2), 'HR'))}"><b>HR/Payroll Menu</b></a>
                <a href="/adminMenu" th:if="${!#strings.isEmpty(username) and (#strings.equals(role, 'ADMIN'))}"><b>Admin Commands</b></a>
                <a href="/logout" th:if="${!#strings.isEmpty(username)}"><b>Logout</b></a>
            </div>
        </header>

        <div id="page">
            <div style="text-align: center;">
                <p style="color:green" th:if="${!#strings.isEmpty(success)}" th:text="${success}"></p>
                <div th:if="${!#lists.isEmpty(errors)}">
                    <p style="color:red;font-weight: bold;">ERRORS</p>
                    <ul style="list-style-position: inside;padding-left: 0;">
                        <li style="color:red" th:each="error : ${errors}" th:text="${error}"></li>
                    </ul>
                </div>

                <h2>Time-Off Requests</h2>
                <p th:if="${!#strings.isEmpty(user.managedBy)}"><b>NOTE: For any questions, please contact HR or your manager, <span th:text="${user.managedBy}"></span>.</b></p>
                <p th:unless="${!#strings.isEmpty(user.managedBy)}"><b>NOTE: For any questions, please contact HR.</b></p>
                <div th:if="${totalPages} &gt; 0">
                    <a th:href="'/viewRequests?page=' + ${prevPage} + '&search=' + ${searched}"><button class="button buttonTheme">View Previous Page</button></a>
                    <a th:href="'/viewRequests?page=' + ${nextPage} + '&search=' + ${searched}"><button class="button buttonTheme">View Next Page</button></a>
                    <br/><br/>

                    <p>You are viewing page <span th:text="${currentPage}"></span> of <span th:text="${totalPages}"></span></p>
                    <p th:if="${!#strings.isEmpty(searched)}"><span th:text="${totalCount}"></span> results for <span th:text="${searched}"></span></p>
                    <span>Search for time-off requests: </span> 
                    <form th:action="@{/viewRequests}" method="get">
                        <input type="text" name="search" id="search" placeholder="Search..."/>
                        <input type="image" th:src="@{/img/search.png}" alt="Search"/>
                    </form>
                    <hr />

                    <h2>Your Requests</h2>
                    <table>
                        <tr>
                            <th>Request ID</th>
                            <th>Reason</th>
                            <th colspan="2">Time Off Period</th>
                            <th>Approved?</th>
                            <th colspan="2">Actions</th>
                        </tr>
                        <tr th:each="request : ${requests}">
                            <td th:text="${request.id}"></td>
                            <td th:text="${request.reason}"></td>
                            <td th:text="${#strings.substring(request.startDate, 0, 10)}"></td>
                            <td th:text="${#strings.substring(request.endDate, 0, 10)}"></td>
                            <td style="color: green;" th:if="${#strings.isEmpty(user.managedBy) and request.hrViewed and (request.hrApproved)}">Approved</td>
                            <td style="color: green;" th:if="${!#strings.isEmpty(user.managedBy) and request.hrViewed and request.managerViewed and (request.hrApproved and request.managerApproved)}">Approved</td>
                            <td style="color: red;" th:if="${#strings.isEmpty(user.managedBy) and request.hrViewed and !(request.hrApproved)}">Denied</td>
                            <td style="color: red;" th:if="${#!strings.isEmpty(user.managedBy) and request.hrViewed and request.managerViewed and !(request.hrApproved and request.managerApproved)}">Denied</td>
                            <td th:if="${!(request.hrViewed and request.managerViewed) and !#strings.isEmpty(user.managedBy)}">Pending Approval</td>
                            <td th:if="${!(request.hrViewed) and #strings.isEmpty(user.managedBy)}">Pending Approval</td>
                            <td><a th:href="${'/editRequest?id=' + request.id}">Edit</a></td>
                            <td><a th:href="${'/withdrawRequest?id=' + request.id}">Withdraw</a></td>
                        </tr>
                    </table>
                </div>

                <div th:if="${(baseCount == 0)}">
                    <p>No requests found.</p>

                    <div th:if="${!#strings.isEmpty(searched)}">
                        <p><span th:text="${totalCount}"></span> results for <span th:text="${searched}"></span></p>
                        <span>Search for requests: </span> 
                        <form th:action="@{/viewRequests}" method="get">
                            <input type="text" name="search" id="search" placeholder="Search..."/>
                            <input type="image" th:src="@{/img/search.png}" alt="Search"/>
                        </form>
                    </div>
                </div>

                <hr/>

                <h2>Make a Time-Off Request</h2>
                <div th:if="${user.entitledDays &gt; 0}">
                    <form th:action="@{/newRequest}" method="post" th:object="${newRequest}">
                        <p>
                            You have <b><span th:text="${user.entitledDays}"></span> days</b> of paid time off available. You must list a reason for your absence. Otherwise,
                            your request may be denied.
                        </p>

                        <label for="startDate">*Start Date: </label><br/>
                        <input type="date" name="startDate" th:field="*{startDate}" /><br/><br/>
                        <label for="endDate">*End Date: </label><br/>
                        <input type="date" name="endDate" th:field="*{endDate}" /><br/><br/>
                        <label for="reason">Reason: </label><br/>
                        <textarea name="reason" rows="25" cols="50" wrap="hard" maxlength="255" style="font-family:Times New Roman, Times, serif; font-size: 12px;">
    
                        </textarea><br/><br/>

                        <input type="submit" value="Submit Request">
                    </form>
                </div>
                <div th:unless="${user.entitledDays &gt; 0}">
                    <p>You have no days of paid time off available.</p>
                </div>
                
                <div th:if="${#lists.size(myUsers) &gt; 0}">
                    <hr/><br/>
                    <h2>Your Employees</h2>
                    <table>
                        <tr>
                            <th>Employee Name</th>
                            <th>Job Title</th>
                            <th>Employee Join Date</th>
                            <th>Request</th>
                        </tr>
                        <tr th:each="myUser : ${myUsers}">
                            <td><span th:text="${myUser.firstName}"></span> <span th:text="${myUser.lastName}"></span></td>
                            <td th:text="${myUser.jobTitle}"></td>
                            <td th:text="${#strings.substring(myUser.joinDate, 0, 10)}"></td>
                            <td th:if="${#lists.size(myUser.timeOff) &gt; 0}">
                                <table>
                                    <tr>
                                        <th>Requested Dates</th>
                                        <th>Reason</th>
                                        <th>Your Action</th>
                                        <th colspan="2">Actions</th>
                                    </tr>
                                    <tr th:each="request : ${myUser.timeOff}">
                                        <td><span th:text="${#strings.substring(request.startDate, 0, 10)}"></span> - <span th:text="${#strings.substring(request.endDate, 0, 10)}"></span></td>
                                        <td th:text="${request.reason}"></td>
                                        <td th:if="${!request.managerViewed}">Pending</td>
                                        <td style="color:green" th:if="${request.managerApproved and request.managerViewed}">Approved</td>
                                        <td style="color:red" th:if="${!request.managerApproved and request.managerViewed}">Denied</td>
                                        <td><a th:href="@{'/managerActionRequest?id=' + ${request.id} + '&approval=true'}">Approve</a></td>
                                        <td><a th:href="@{'/managerActionRequest?id=' + ${request.id} + '&approval=false'}">Deny</a></td>
                                    </tr>
                                </table>
                            </td>
                            <td th:unless="${#lists.size(myUser.timeOff) &gt; 0}">
                                No pending requests.
                            </td>
                        </tr>
                    </table>
                </div>
                
            </div>
            <br/><br/>
        </div>

        <footer>
            &copy; <span th:text="${year}"></span> <span th:text="${company}">, All rights reserved.</span> <br/>
            Powered by Employee Wiki&trade; <br/>
            <a href="#top">Back to Top</a>
        </footer>
    </body>
</html>